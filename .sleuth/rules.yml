rules:
  - transition-issues-on-deploys:
      conditions:
        - environment='production'
      actions:
        - transition_mentioned_issues:
            state: 'deploy'
        
  - failed-rules-notify:
      conditions:
        - deployed_for>='1m'
        - failed_rules!=0
      actions:
        - slack_channel_message:
            channel: '#testing'
            message: 'The following deploys have Sleuth Actions that failed: {{deploy_slack}}'

  - slack-with-channel-id:
      conditions:
        - environment='production'
        - magnitude='Small'
      actions:
        - slack_channel_approval:
            name: 'Approval test for small batches'
            prompt: "{{ authors_slack }}, {{ deploy_slack }} is a small batch deploy. Do you want to approve it?"
            votes_required: 1
            channel: 'C04H3731WKE'
            on_success:
              - add_to_deploy_message_thread: Thank you for approving!
